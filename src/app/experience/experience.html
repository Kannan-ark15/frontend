<app-navbar [menuItems]="allMenuItems()"></app-navbar>

<!-- Hero Video Section -->
<section class="hero-video-section">
  <div class="video-container">
    <video
      #heroVideo
      class="hero-video"
      autoplay
      muted
      loop
      playsinline
      poster="assets/experience-poster.jpg"
    >
      <source src="assets/experience-hero.mp4" type="video/mp4" />
      Your browser does not support the video tag.
    </video>
    <div class="video-overlay"></div>
    <div class="video-content">
      <h1 class="video-title">My Journey</h1>
      <p class="video-subtitle">From foundations to innovation</p>
    </div>
  </div>
</section>

<!-- Experience Timeline Section -->
<div class="experience-container" id="timeline-section">
  <header class="timeline-header">
    <h1 class="main-title">Experience Timeline</h1>
    <p class="subtitle">A cinematic look at my professional and academic journey</p>
  </header>

  <div class="timeline">
    <div class="timeline-line"></div>

    @for (item of timelineItems(); track item.id) {
      <div
        class="timeline-item"
        [class.expanded]="item.expanded"
        [style.--item-color]="item.color"
      >
        <!-- Timeline Node -->
        <div
          class="timeline-node"
          [class.active]="item.expanded"
          (click)="toggleExpand(item.id)"
        >
          <lucide-icon [img]="item.icon" class="node-icon" [color]="item.color"></lucide-icon>
          <div class="node-pulse"></div>
        </div>

        <!-- Content Card -->
        <div class="timeline-content">
          <div class="content-header">
            <div class="header-left">
              <h3 class="content-label">{{ item.label }}</h3>
              <span class="content-duration">{{ item.duration }}</span>
            </div>
            <!-- Collapse/Expand Button -->
            <button 
              class="toggle-btn" 
              (click)="toggleExpand(item.id)"
              [attr.aria-label]="item.expanded ? 'Collapse' : 'Expand'"
            >
              <lucide-icon 
                [img]="ChevronDown" 
                class="expand-icon" 
                [class.rotated]="item.expanded"
                [color]="item.color"
              ></lucide-icon>
            </button>
          </div>

          <h2 class="content-heading">{{ item.heading }}</h2>
          <p class="content-description">{{ item.description }}</p>

          <!-- Flowchart (Collapsible) -->
          @if (item.flowchart && item.expanded) {
            <div class="flowchart">
              @for (node of item.flowchart; track $index; let isLast = $last) {
                <div>
                  <!-- Wire connecting nodes -->
                  @if ($index > 0) {
                    <div
                      class="flowchart-wire"
                      [class.animated]="isFlowchartNodeAnimated(item.id, $index)"
                    >
                      <div class="wire-flow"></div>
                    </div>
                  }

                  <!-- Flowchart Node -->
                  <div
                    class="flowchart-node"
                    [class.revealed]="isFlowchartNodeAnimated(item.id, $index)"
                  >
                    <h4 class="node-title">{{ node.title }}</h4>
                    <p class="node-text" [innerHTML]="node.text"></p>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
